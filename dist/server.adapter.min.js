import e from"./server.js";import t from"./ssr.js";import{extname as o}from"node:path";import{stat as s}from"node:fs/promises";const n=globalThis.document=t,a=_=>{},r=e=>{e.statusCode=404,e.end("404")},c={js:"text/javascript",json:"application/json",css:"text/css"};(async t=>{const{router:l,template:i,host:p,onReady:m=a,onServer:d=a}=await import(t),h=new e({host:p});h.get("*",((e,t)=>e.on("close",(()=>{console.log(t.statusCode,e.method,e.url.pathname)})))),d(h),h.get("*.*",(async(e,t)=>{const n=e.url.pathname,a=o(n).slice(1),l=process.cwd()+n;try{await s(l),await t.sendFile(l,c[a])}catch(e){r(t)}})),h.get("*",(async({url:e},t)=>{const o=l.route(e.pathname),s=n.createElement("div");if(o.length){for await(let t of o){const{handler:o,params:r}=t;let c=await o({params:r,url:e,onMount:a});c.nodeType&&(c={mountTo:"app",el:c}),(n.find(s,c.mountTo)??s).replaceChildren(c.el)}t.end(i({content:s.innerHTML}))}else r(t)})),h.listen().then(m)})(process.argv.at(-1)).catch(console.error);
