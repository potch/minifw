const t="value",e=t=>"object"==typeof t,n=(t,e)=>[...t].map(e);export const using=(t,e)=>(e(),t());export const collect=(t,e,n=[])=>(using(t((t=>n.push(t))),e),n);export const event=(t=new Set)=>[(...e)=>n(t,(t=>t(...e))),e=>(t.add(e),()=>t.delete(e))];const o=[];export const signal=(e,n=((t,e)=>t===e))=>{const[c,s]=event();return{set[t](t){n(e,t)||(e=t,c())},touch(){c()},get[t](){return o[0]&&o[0].add(this),e},peek:()=>e,watch:s}};export const[emitEffect,onEffect]=event();export const effect=(t,...e)=>{let c=0;o.push(new Set(e));const s=()=>{c||(c=1,t(((...t)=>emitEffect(effect(...t)))),c=0)};s();const r=n(o.at(-1),(t=>t.watch(s)));return o.pop(),()=>n(r,(t=>t()))};export const computed=(e,n)=>{const o=signal(n);return effect((()=>o[t]=e(o[t]))),o};export const setProp=(n,o,c)=>{"ref"==o&&t in c?c[t]=n:e(c)&&t in c?emitEffect(effect((()=>setProp(n,o,c[t])))):"function"==typeof c||e(c)||o in n?n[o]&&e(n[o])?assign(n[o],c):n[o]=null===c?"":c:null!==c&&(0!=c||o.startsWith("data-")||o.startsWith("aria-"))?n.setAttribute(o,c):n.removeAttribute(o)};export const assign=(t,n)=>(n&&Object.entries(n).forEach((([n,o])=>{t.nodeType?setProp(t,n,o):e(t[n])&&e(o)?assign(t[n],o):t[n]=o})),t);export const dom=(t,n,...o)=>{let c;return"function"==typeof t?c=mount((()=>t(n,o))):(c=document.createElement(t),n&&e(n)&&!n.nodeType?assign(c,n):n&&o.unshift(n),c.append(...o.flat(1))),c};export const mount=t=>{const e=[];let n;return emitEffect(effect((()=>{for(;e.length;)try{e.pop()()}catch(t){}collect(onEffect,(()=>{const e=t();n&&e&&n.replaceWith(e),n=e}),e)}))),n};export const on=(t,...e)=>(t.addEventListener(...e),()=>t.removeEventListener(...e));
