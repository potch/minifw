import{on,event as t}from"./fw.js";export default async e=>{const{router:o}=await import(e),a=new WeakMap,n=async(e,n=0)=>{const r=o.route(e.pathname);n||history.pushState({},"",e);for await(let o of r){const[n,r]=t(),{params:l,handler:c}=o;let i=await c({params:l,onMount:r,url:e});if(!i)continue;i.tagName&&(i={mountTo:"app",el:i});const p=document.getElementById(i.mountTo)??document.body;if(p){const t=a.get(p)||[];for(;t.length;)t.pop()?.call?.();p.replaceChildren(i.el),setTimeout((()=>{a.set(p,n().flat(1/0))}),0)}}};on(document.body,"click",(t=>{t.target.href&&(t.preventDefault(),n(new URL(t.target.href)))})),on(window,"popstate",(()=>{n(new URL(window.location),1)})),n(new URL(window.location),1)};
