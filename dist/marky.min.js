let e=(e,r,l)=>e.slice(r,l),r=(r,t)=>t===e(r,0,l(t)),l=e=>e?.length??0,t=e=>e.at(-1),i=e=>l(e.match(/^(.)\1*/)?.[0]),p="blockquote",f=(r,[t,i])=>{let p,u,n,o,s,c;if(r.map)for(c=0;c<l(r);c++)if(p=r[c],p?.t)f(p,[t,i]);else if(p)for(n of(u=p.matchAll(t)??[],o=0,u))s=n.index+l(n[0]),r.splice(c,1,e(p,o,n.index),i(n),e(p,s)),c+=2,o=s;return r},u=(e,r=[],l={})=>({t:e,c:r||[],p:l}),n=(e,r,l=e)=>[RegExp(e+"([^"+l+"]+)"+e,"g"),e=>u(r,[e[1]])],o=[[/(\!?)\[([^\]]+)\]\(([^\)]+)\)/g,([_,e,r,l])=>e?u("img",null,{src:l,alt:r}):u("a",[r],{href:l})],n("`","code"),n("\\*","i"),n("_","u"),n("\\*\\*","b","\\*")];export let marky=n=>{let s,c,h,a,m,b,g=[],d=[g],x=(e,r=t(d))=>(r.c??r)?.push?.(e);return n.split("\n").map((n=>{let[k,q,v]=(l=>(s=i(l),c=l.trim(),h=i(c),c?r(c,"* ")||r(c,"- ")?["li",e(c,2),1+(s/2|0)]:r(c,"#")?["h"+h,e(c,h+1)]:"---"==c||"***"==c?["hr"]:"```"==e(c,0,3)?["pre","",e(c,3)]:s>=2?[p,c]:r(c,">")?[p,e(c,1)]:["p",l]:["br"]))(n);if(q){q=[q];for(let e of o)q=f(q,e)}else k===p&&(q=[u("br")]);if("li"==k)for(("ul"!==t(d).t||l(d)-1<v)&&(y=u("ul"),x(y),d.push(y));l(d)-1>v;)d.pop();else d=[g];var y;if("p"==a&&"p"==k)return m.push(...q);if(k==p){if(a==p)return m.push(...q);q=[u("p",q)]}if("pre"==k){if("pre"==a)return b=null;b=u("code","",{lang:v}),q=[b]}if("br"!=k||"br"==a){if("pre"==a&&b)return b.c.push(n+"\n");x(u(k,q)),[a,m]=[k,q]}})),g};
