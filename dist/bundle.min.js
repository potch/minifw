import e from"htm";let t=0,a=document,n=e=>"object"==typeof e,r=(e,t)=>[...e].map(t),o=(e,t)=>{for(let[i,d]of Object.entries(t||{}))e.nodeType?(a=e,r=i,p=d,p?.call||n(p)||r in a?n(a[r])?o(a[r],p):a[r]=null===p?"":p:null===p||!1===p&&"-"!=r[4]?a.removeAttribute(r):a.setAttribute(r,p)):n(e[i])&&n(d)?o(e[i],d):e[i]=d;var a,r,p;return e},p=(e,...t)=>(e.addEventListener(...t),_=>e.removeEventListener(...t)),i=(e=new Set)=>[(...t)=>r(e,(e=>e(...t))),t=>(e.add(t),_=>e.delete(t))],d=(e,[a,n]=i())=>({set val(t){e!==t&&(e=t,a())},get val(){return t&&t.add(this),e},peek:_=>e,watch:n});p(window,"DOMContentLoaded",(async()=>{const{router:e}=await Promise.resolve().then((function(){return s})),t=[],a=async(a,n)=>{const r=e.route(a.pathname);for(;t.length;)t.pop()?.call();if(r.length){const[e,n]=i(),{params:o,handler:p}=r[0],d=await p({params:o,onMount:n,url:a});document.body.replaceChildren(d),history.pushState({},"",a),t.push(...e())}};p(document.body,"click",(async e=>{e.target.href&&(e.preventDefault(),await a(new URL(e.target.href)))})),p(window,"popstate",(()=>{a(new URL(window.location))})),a(new URL(window.location))}));const c=e.bind(((e,t,...n)=>{let r=o(a.createElement(e),t);return r.append(...n),r})),l=((e=[])=>({handle(t,a){const n=t instanceof RegExp?t:new RegExp("^"+t.replace(/\[([^\]]+)\]/g,((_,e)=>`(?<${e}>[^\\/]+)`))+"$");e.push({path:t,pattern:n,handler:a})},route:t=>e.reduce(((e,a)=>{const n=a.pattern.exec(t);return n?[...e,{...a,params:n.groups}]:e}),[])}))(),u=c`<nav>
  <a href="/">home</a>
  <a href="/about">about</a>
  <a href="/party/farty">party</a>
  <a href="/party/hardy">hard</a>
</nav>`;l.handle("/",(()=>c`<div>
    ${u}
    <p>Welcome Home!</p>
    <form action="/search">
      <input name="query" />
      <button>go</button>
    </form>
  </div>`)),l.handle("/about",(({onMount:e})=>{const a=d(1),n=c`<span id="counter">${a.val}</span>`;(e=>{let a,n=0,r=_=>{n||(n=1,e(),n=0)};t=new Set,e(),a=[...t].map((e=>e.watch(r))),t=0})((()=>{n.innerText=a.val}));const r=c`<button>inc</button>`;return e((()=>p(r,"click",(()=>{a.val++})))),c`
    <div>
      ${u}
      <p>About</p>
      <div>${r} ${n}</div>
    </div>
  `})),l.handle("/party/[time]",(({params:e})=>c`<div>
    ${u}
    <p>Party on, ${e.time}</p>
  </div>`)),l.handle("/search",(({url:e})=>c`<div>
    ${u}
    <p>Searching for: ${e.searchParams.get("query")}</p>
  </div>`));var s=Object.freeze({__proto__:null,router:l});
