export const serverChannel=({sendLastOnConnect:e=1}={})=>{const n=new Set;let t;return[(o,r)=>{console.log("[channel] new client"),n.add(r),r.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache","Access-Control-Allow-Origin":"*"}),r.write("retry: 5000\n\n"),t&&e&&r.write(`data: ${JSON.stringify(t)}\n\n`),r.on("close",(()=>{console.log("[channel] closing"),n.delete(r)}))},e=>{const o=JSON.stringify(e);n.forEach((e=>{e.write(`data: ${o}\n\n`)})),t=e}]};export const clientChannel=(e,n,{withCredentials:t=0}={})=>{let o;return o=new EventSource(e,{withCredentials:t}),o.addEventListener("message",(e=>{n(JSON.parse(e.data))})),o.addEventListener("error",(e=>{console.log("[live] connection closed")})),()=>{console.log("[channel] closing source"),o.close()}};
