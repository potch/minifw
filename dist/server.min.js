import{Server as t}from"node:http";import e from"./router.js";const r=(t,e)=>t instanceof RegExp?t:e;class s extends t{constructor({host:t=new URL("http://localhost:8080/"),routes:r=[]}={}){super(((t,e)=>this.handler(t,e).catch(console.error))),Object.assign(this,e(r),{host:t})}async handler(t,e){t.url=new URL(t.url,this.host);const{pathname:r}=t.url,s=[],o=t.method+":"+r,n=this.route(o);t.body=new Promise((e=>{t.on("data",(t=>s.push(t))),t.on("end",(()=>e(Buffer.concat(s))))}));for(let{handler:r,params:s}of n)if(t.params=s,await(r?.(t,e)),e.writableEnded)return}get(t,e){this.handle(r(t,"GET:"+t),e)}post(t,e){this.handle(r(t,"POST:"+t),e)}listen(){return new Promise((t=>super.listen(this.host.port,t)))}}export{e as router,s as Server};
